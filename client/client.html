<!DOCTYPE html>
<html lang="en">

<head>
  <title>Recipe site</title>
  <link href="https://fonts.googleapis.com/css2?family=Sansita+Swashed&display=swap" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="/style.css">

  <script>

    const handleResponse = (xhr, parseResponse) => {
      const content = document.querySelector('#content');

      switch (xhr.status) {
        case 200:
          content.innerHTML = '<b>Success!</b>';
          break;
        case 201:
          content.innerHTML = '<b>Created!</b>';
          break;
        case 204:
          content.innerHTML = '<b>Updated (No Content)</b>'
          break;
        case 400:
          content.innerHTML = '<b>Bad Request :-(</b>';
          break;
        case 404:
          content.innerHTML = '<b>Resource Not Found</b>';
          break;
        default:
          content.innerHTML = '<b>Error code not implemented by client :-()</b>';
          break;
      }

      if (parseResponse) {
        const obj = JSON.parse(xhr.response);
        console.dir(obj);
        content.innerHTML += `<p>${xhr.response}</p>`;
      } else {
        content.innerHTML += `<p>metadata received</p>`;
      }
    };


    const requestUpdate = (e, userForm) => {
      const url = userForm.querySelector('#urlField').value;
      const method = userForm.querySelector('#methodSelect').value;

      const xhr = new XMLHttpRequest();
      xhr.open(method, url);
      xhr.setRequestHeader("Accept", "application/json"); // not necessary in this instance
      if (method === 'get') {
        // getting info back from server
        xhr.onload = () => handleResponse(xhr, true);
      } else {
        // only getting metadata
        xhr.onload = () => handleResponse(xhr, false);
      }


      xhr.send();

      e.preventDefault();
      return false; // prevents event bubbling
    }

    const updateUsers = (e, nameForm) => {
      //const url = userForm.querySelector('#urlField').value;
      //const method = userForm.querySelector('#methodSelect').value;
      const name = nameForm.querySelector('#nameField').value;
      const author = nameForm.querySelector('#authorField').value;
      const serves = nameForm.querySelector('#servesField').value;
      const instructions = nameForm.querySelector('#instructionField').value;


      const xhr = new XMLHttpRequest();
      xhr.open('post', "/addUser");

      xhr.setRequestHeader("Accept", "application/json"); // not necessary in this instance

      xhr.onload = () => handleResponse(xhr, true);

      const formData = `name=${name}&author=${author}&serves=${serves}&instructions=${instructions}`;

      xhr.send(formData);

      e.preventDefault();
      return false; // prevents event bubbling
    }



    const init = () => {
      const userForm = document.querySelector('#userForm');
      const nameForm = document.querySelector('#nameForm');

      const getUsers = (e) => requestUpdate(e, userForm);
      const makeUsers = (e) => updateUsers(e, nameForm);

      userForm.addEventListener('submit', getUsers);
    }

    window.onload = init;



  </script>
</head>

<body>
  <section id="top">
    <h3 id="pgTitle">Recipe Book</h3>

    <input id="searchBar" type="text" size="20" maxlenght="20" autofocus value="Search Here">
    <div id="recipeContentvert">
      <div id="recipeContenthor">
        <div id="RecipeBox">
          <h4>Rec. Name</h4>
          <p>Serves: 1</p>
          <p>Author: Nimoy Lembardo</p>
          <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et
            dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex
            ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat
            nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit
            anim id est laborum.</p>
        </div>

        <div id="RecipeBox">
          <h4>Rec. Name</h4>
          <p>Serves: 1</p>
          <p>Author: Nimoy Lembardo</p>
          <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et
            dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex
            ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat
            nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit
            anim id est laborum.</p>
        </div>

        <div id="RecipeBox">
          <h4>Rec. Name</h4>
          <p>Serves: 1</p>
          <p>Author: Nimoy Lembardo</p>
          <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et
            dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex
            ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat
            nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit
            anim id est laborum.</p>
        </div>
      </div>

      <div id="recipeContenthor">
        <div id="RecipeBox">
          <h4>Rec. Name</h4>
          <p>Serves: 1</p>
          <p>Author: Nimoy Lembardo</p>
          <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et
            dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex
            ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat
            nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit
            anim id est laborum.</p>
        </div>

        <div id="RecipeBox">
          <h4>Rec. Name</h4>
          <p>Serves: 1</p>
          <p>Author: Nimoy Lembardo</p>
          <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et
            dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex
            ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat
            nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit
            anim id est laborum.</p>
        </div>

        <div id="RecipeBox">
          <h4>Rec. Name</h4>
          <p>Serves: 1</p>
          <p>Author: Nimoy Lembardo</p>
          <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et
            dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex
            ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat
            nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit
            anim id est laborum.</p>
        </div>
      
    </div>

    <hr>

    <h3>Have a Recipe? Submit it!</h3>

    <form id="nameForm" action="/addUser" method="post">

      <label for="name" class="formTxt">Recipe Name: </label>
      <input id="nameField" type="text" name="name" class="formItem"/>

      <label for="author" class="formTxt">Author: </label>
      <input id="authorField" type="text" name="author" class="formItem"/>

      <label for="serves" class="formTxt">Serves: </label>
      <input id="servesField" type="number" name="serves" min="0" max="100" step="1" class="formItem"/>

      <label for="instructions" class="formTxt">Instruction: </label>
      <textarea id="instructionField" name="insturction" rows=15 col=50 class="formItem"></textarea>

      <input type="submit" value="Submit" class="formItem"/>
    </form>

    <form id="userForm" action="/getUsers" method="get">
      <select id='urlField'>
        <option value='/getUsers'>/getUsers</option>
        <option value='/notReal'>/notReal</option>
      </select>
      <select id="methodSelect">
        <option value="get">GET</option>
        <option value="head">HEAD</option>
      </select>
      <input type="submit" value="Get User" />
    </form>


  </section>
  <section id="content">
  </section>
</body>

</html>